# ShitBF 0.4.0
## 목차
- [섹션](#섹션)
	- [헤더(Header)](#헤더header)
		- [ShitBF 버전](#shitbf-버전)
		- [ShitBC 버전](#shitbc-버전)
	- [의존성 목록(Dependencies)](#의존성-목록dependencies)
		- [의존성 정보(Dependency Information)](#의존성-정보dependency-information)
	- [매핑 목록(Mappings)](#매핑-목록mappings)
		- [구조체 매핑 정보(Structure Mapping Information)](#구조체-매핑-정보structure-mapping-information)
		- [함수 매핑 정보(Function Mapping Information)](#함수-매핑-정보function-mapping-information)
	- [상수 풀(Constant Pool)](#상수-풀constant-pool)
	- [구조체 목록(Structures)](#구조체-목록structures)
		- [구조체 정보(Structure Information)](#구조체-정보structure-information)
	- [함수 목록(Functions)](#함수-목록functions)
		- [함수 정보(Function Information)](#함수-정보function-information)
	- [진입점(Entrypoint)](#진입점entrypoint)
- [명령어](#명령어)

## 섹션
### 헤더(Header)
헤더는 ShitBF에 대한 정보를 저장하는 섹션입니다. 총 8바이트로 구성됩니다.

|이름|크기|값|엔디안|설명|
|:-:|:-:|:-:|:-:|:-:|
|매직넘버|4|0x74687468|Big|이 파일이 ShitBF임을 나타냄|
|ShitBF 버전|2|후술|Little|이 파일이 어떤 버전의 ShitBF 스펙에 따라 저장되었는지 나타냄|
|ShitBC 버전|2|후술|Little|이 파일이 어떤 버전의 ShitBC 스펙에 따라 저장되었는지 나타냄|

#### ShitBF 버전
|버전|값|
|:-:|:-:|
|0.1.0|0x0000|
|0.2.0|0x0001|
|0.3.0|0x0002|
|0.4.0|0x0003|

#### ShitBC 버전
|버전|값|
|:-:|:-:|
|0.1.0|0x0000|
|0.2.0|0x0001|
|0.3.0|0x0002|
|0.4.0|0x0003|

### 의존성 목록(Dependencies)
의존성 목록은 현재 모듈의 다른 모듈에 대한 의존성 목록을 저장하는 섹션입니다. 최대 4,294,967,295개의 의존성 정보를 저장할 수 있으나, 연쇄적인 의존성에 따라 최대 개수가 줄어듭니다.

|이름|크기|엔디안|설명|
|:-:|:-:|:-:|:-:|
|의존성 정보의 개수|4|Little||
|의존성 정보|?||의존성 정보의 개수만큼 의존성 정보가 순서대로 저장됨|

#### 의존성 정보(Dependency Information)
|이름|크기|엔디안|설명|
|:-:|:-:|:-:|:-:|
|모듈 경로의 길이|4|Little||
|모듈 경로|?||UTF-8로 인코딩 된 모듈 경로가 저장됨|

모듈 경로는 절대 경로이거나 상대 경로이며, 디렉터리를 구분하기 위해 슬래시(`/`)를 사용합니다. 절대 경로인 경우 슬래시로 시작되며, ShitBC 구현체에 따라 실제 모듈 경로가 적절하게 계산됩니다. 표준 라이브러리나 외부 라이브러리의 모듈을 나타낼 때 활용할 수 있습니다. 상대 경로인 경우 현재 모듈의 경로를 기준으로 실제 모듈 경로가 계산됩니다. 현재 프로젝트의 다른 모듈을 나타낼 때 활용할 수 있습니다.

### 매핑 목록(Mappings)
매핑 목록은 의존성이 있는 모듈에 있는 함수나 구조체에 대한 매핑 정보를 저장하는 섹션입니다. 함수는 최대 4,294,967,296개, 구조체는 최대 2,147,483,628개의 매핑 정보를 저장할 수 있으나, 함수는 현재 프로그램에 있는 함수의 개수에 따라, 구조체는 현재 프로그램에 있는 상수와 구조체의 개수에 따라 최대 개수가 줄어듭니다.

|이름|크기|엔디안|설명|
|:-:|:-:|:-:|:-:|
|구조체 매핑 정보의 개수|4|Little||
|구조체 매핑 정보|?||구조체 매핑 정보의 개수만큼 구조체 매핑 정보가 순서대로 저장됨|
|함수 매핑 정보의 개수|4|Little||
|함수 매핑 정보|?||함수 매핑 정보의 개수만큼 함수 매핑 정보가 순서대로 저장됨|

#### 구조체 매핑 정보(Structure Mapping Information)
|이름|크기|엔디안|설명|
|:-:|:-:|:-:|:-:|
|모듈 번호|4|Little||
|이름의 길이|4|Little||
|이름|||해당 모듈에 있는 매핑할 구조체의 이름이 UTF-8로 저장됨|

#### 함수 매핑 정보(Function Mapping Information)
|이름|크기|엔디안|설명|
|:-:|:-:|:-:|:-:|
|모듈 번호|4|Little||
|이름의 길이|4|Little||
|이름|||해당 모듈에 있는 매핑할 함수의 이름이 UTF-8로 저장됨|

### 상수 풀(Constant Pool)
상수 풀은 상수를 저장하는 섹션입니다. 최대 4,294,967,296개의 상수를 저장할 수 있으나, 구조체의 수에 따라 최대 개수가 줄어듭니다.

|이름|크기|엔디안|설명|
|:-:|:-:|:-:|:-:|
|`int` 상수의 개수|4|Little||
|`int` 상수|?|Little|`int` 상수의 개수만큼 Little 엔디안으로 4바이트 정수가 순서대로 저장됨|
|`long` 상수의 개수|4|Little||
|`long` 상수|?|Little|`long` 상수의 개수만큼 Little 엔디안으로 8바이트 정수가 순서대로 저장됨|
|`double` 상수의 개수|4|Little||
|`double` 상수|?|Little|`double` 상수의 개수만큼 Little 엔디안으로 8바이트 IEE754 부동소수점이 순서대로 저장됨|

### 구조체 목록(Structures)
구조체 목록은 구조체의 필드 목록을 저장하는 섹션입니다. 최대 2,147,483,628개의 구조체를 저장할 수 있으나, 상수의 개수와 구조체 매핑 목록의 개수에 따라 최대 개수가 줄어듭니다. 각 구조체는 최대 4,294,967,296개의 필드를 가질 수 있습니다.

|이름|크기|엔디안|설명|
|:-:|:-:|:-:|:-:|
|구조체의 개수|4|Little||
|구조체 정보|?||구조체의 개수만큼 구조체 정보가 순서대로 저장됨|

#### 구조체 정보(Structure Information)
|이름|크기|엔디안|설명|
|:-:|:-:|:-:|:-:|
|이름의 길이|4|Little||
|이름|?||구조체의 이름이 UTF-8로 저장됨|
|필드의 개수|4|Little||
|필드|?|Little|필드의 개수만큼 Little 엔디안으로 자료형 번호가 순서대로 저장됨|

배열 필드의 경우 배열의 원소의 개수가 8바이트 Little 엔디안으로 자료형 번호 뒤에 덧붙여집니다.

### 함수 목록(Functions)
함수 목록은 함수에 대한 정보와 함수에 소속된 명령어들을 저장하는 섹션입니다. 최대 4,294,967,296개의 함수를 저장할 수 있으나, 함수 매핑 목록의 개수에 따라 최대 개수가 줄어듭니다. 각 함수는 최대 65,536개의 매개 변수, 최대 4,294,967,296개의 레이블, 최대 18,446,744,073,709,551,616개의 명령어를 가질 수 있으며, 종료할 때 특정한 값을 반환할 수 있습니다.

|이름|크기|엔디안|설명|
|:-:|:-:|:-:|:-:|
|함수의 개수|4|Little||
|함수 정보|?||함수의 개수만큼 함수 정보가 순서대로 저장됨|

#### 함수 정보(Function Information)
|이름|크기|엔디안|설명|
|:-:|:-:|:-:|:-:|
|이름의 길이|4|Little||
|이름|?||함수의 이름이 UTF-8로 저장됨|
|매개 변수의 개수|2|Little||
|반환 여부|1||함수가 어떤 값을 반환하면 1, 반환하지 않으면 0이 저장됨|
|레이블의 개수|4|Little||
|레이블|?|Little|레이블의 개수만큼 Little 엔디안으로 레이블이 가리키는 명령어의 번호가 순서대로 저장됨|
|명령어의 개수|8|Little||
|명령어|?||명령어의 개수만큼 명령어가 순서대로 저장됨|

### 진입점(Entrypoint)
진입점은 진입점에 소속된 명령어들을 저장하는 섹션입니다. 최대 4,294,967,296개의 레이블, 최대 18,446,744,073,709,551,616개의 명령어를 가질 수 있습니다.

|이름|크기|엔디안|설명|
|:-:|:-:|:-:|:-:|
|레이블의 개수|4|Little||
|레이블|?|Little|레이블의 개수만큼 Little 엔디안으로 레이블이 가리키는 명령어의 번호가 순서대로 저장됨|
|명령어의 개수|8|Little||
|명령어|?||명령어의 개수만큼 명령어가 순서대로 저장됨|

## 명령어
[ShitBC 스펙](ShitBC.md)을 참조하세요.